{% load staticfiles %}

<html>
<head>
    <title>{{person.person_name}}</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static "resume_prac/detail.sass" %}">

    <script src="https://unpkg.com/vue"></script>

    <script>
    window.onload = function () {
      Vue.component('blog-articles', {
        template: '#my-template',
        props: ['datesArticles'],
        data() {
          return {
            searchQuery: ''
          }
        },
        computed: {
          searchedArticles() {
            var searchRegex = new RegExp(this.searchQuery, 'i');
            var searchedObj = {};

            if(this.searchQuery == '') {
               return this.datesArticles;
            }

            for(var date in this.datesArticles) {
              searchedObj[date] = this.datesArticles[date].filter((article) => {
                return searchRegex.test(article.title) ||
                       searchRegex.test(article.teaser) ||
                       searchRegex.test(article.published_at) ||
                       searchRegex.test(date);
              });
            }
            return searchedObj;
          }
        },
        methods: {
          anyArticle() {
            return this.countAllArticles() ? true : false;
          },
          countAllArticles() {
            var count = 0;
            for(var date in this.searchedArticles) {
              count += this.searchedArticles[date].length;
            }
            return count;
          }
        }
      });

      new Vue({
        el: '#app',
        data: {
          datesArticles: {
            'September, 2016': [
              {
                title: '다섯번째',
                slug: 'five',
                teaser: 'five',
                published_at: '30.09.2016.'
              },
              {
                title: 'Four',
                slug: 'four',
                teaser: 'four',
                published_at: '15.09.2016.'
              }
            ],
            'April, 2016': [
              {
                title: 'Three',
                slug: 'three',
                teaser: 'three',
                published_at: '14.04.2016.'
              },
              {
                title: 'Two and a half',
                slug: 'two-and-a-half',
                teaser: 'two and a half',
                published_at: '02.04.2016.'
              }
            ],
            'December, 2015': [
              {
                title: 'Two',
                slug: 'two',
                teaser: 'two',
                published_at: '25.12.2015.'
              },
              {
                title: 'One',
                slug: 'one',
                teaser: 'one',
                published_at: '01.12.2015.'
              }
            ]
          }
        }
      });
    }


      </script>
</head>
<body style="padding:5%">
  <nav class="navbar navbar-toggleable-md navbar-inverse bg-inverse fixed-top">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" href="/resume">MYR</a>

        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="/resume">전체보기 <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link btn btn-outline-success my-2 my-sm-0" href="/resume/write">추가하기</a>
            </li>
          </ul>
          <form class="form-inline my-2 my-lg-0" action="{% url 'resume:search' %}" method="get" accept-charset="utf-8">
         <input class="form-control mr-sm-2 searchfield" id="searchbox" name="q" type="text" placeholder="이름으로 검색하세요">
         <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
       </form>
        </div>
      </nav>
<div class="content container">

  <div class="row" style="margin-top:20px">
      <div class="col-md-2">
          <div>
          <img src="{{person.profile_image.url}}" alt="..." class="rounded-circle img-thumbnail img-fluid" style="width:160px; height:160px">
          </div>
      </div>
      <div class="col-md-10">
          <div >
            <h1>{{person.person_name}} </h1>
            <h4><span class="badge badge-pill badge-success">{{person.position}}</span> </h4>
          </div>
      </div>
  </div>

    <div class="row">
        <div class="col-md-16">
            <div style="margin-top:20px">
              {% for sk in person.skill_set.all%}
              <h4>{{ sk.devstack }}
                 <div class="progress" style="margin-top:10px">
                   <div class="progress-bar progress-bar-striped bg-info" role="progressbar" style="width: {% widthratio sk.degree 100 100 %}%" aria-valuenow="{% widthratio sk.degree 100 100 %" aria-valuemin="0" aria-valuemax="100">{{sk.degree}}%</div>
                 </div>
               </h4>
              {% endfor %}
            </div>

            {% verbatim %}
            <div id='app'>
            <blog-articles :dates-articles='datesArticles'></blog-articles>
            </div>

            <template id='my-template'>
              <div class='container'>
                <input v-model='searchQuery' class='search-box' placeholder='Search for articles...'>
                <div class='timeline' v-if='anyArticle()'>
                  <div v-for='(dateWithArticles, date) in searchedArticles'>
                    <p v-if='dateWithArticles.length > 0' class='date'>{{ date }}</p>
                    <div v-for='article in dateWithArticles' class='article'>
                      <span class='dot'></span>
                      <p class='article-date'>{{ article.published_at }}</p>
                      <h3><a :href="'#' + article.slug">{{ article.title }}</a></h3>
                      <p>{{ article.teaser }}</p>
                    </div>
                  </div>
                </div>
                <p v-else>No articles found.</p>
              </div>
            </template>
            {% endverbatim %}
        </div>




    </div>
</div>
</body>

</html>
